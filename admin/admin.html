<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEST BAHASA KOREA</title>

<style>
body{margin:0;font-family:'Segoe UI',Arial;background:#f5f5f5}
#login-page{min-height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') center/cover no-repeat}
.login-container{width:90%;max-width:280px;padding:35px;text-align:center;
background:rgba(255,255,255,.12);backdrop-filter:blur(6px)}
.login-container h1,.login-container p{color:#fff}
input{width:88%;padding:14px;margin:10px 0}
button{width:100%;padding:16px;background:#3f51b5;color:#fff;border:none;font-weight:bold}

#quiz-page{display:none;min-height:100vh;padding:70px 0;background:linear-gradient(#fdf6ec,#f7efe2)}
.header-fixed{position:fixed;top:0;width:100%;display:flex;gap:6px;background:#fff;padding:6px;z-index:1000}
.timer,.submit-top{flex:1;padding:12px 0;text-align:center;color:#fff;font-weight:bold}
.timer{background:#4caf50}.submit-top{background:#f44336}
.container{max-width:540px;margin:auto;height:calc(100vh - 140px);overflow:auto}
.question-wrapper{display:none;margin-bottom:30px}
.question-wrapper.active{display:block}
.box-passage{background:#e3f2fd;padding:20px;border:2px solid #bbdefb}
.box-passage audio,.box-passage img{width:100%;margin-top:10px}
.box-question{background:#fff3e0;padding:20px;border:2px solid #ffcc80}
.options{margin-top:15px}
.option-item{display:flex;align-items:flex-start;margin:12px 0}
.option-item input{display:none}
.option-circle{width:28px;height:28px;border:1.5px solid #000;border-radius:50%;
display:flex;align-items:center;justify-content:center;margin-right:10px}
.option-item input:checked + .option-circle{background:#bbdefb}
.nav-bottom{position:fixed;bottom:0;width:100%;display:flex;gap:6px;background:#fff;padding:6px}
.nav-bottom button{flex:1;padding:12px;color:#fff;border:none;font-weight:bold}
#prev{background:#2196f3}#next{background:#ff9800}
#result-page{display:none;max-width:600px;margin:auto;padding:20px}
.result-box{background:#fff;border:2px solid #ddd;padding:20px}
.wrong-item{margin-top:15px;padding:12px;background:#ffebee;border-left:5px solid #f44336}
.correct{color:green;font-weight:bold}
.back-btn{margin-top:20px;padding:14px;background:#3f51b5;color:#fff;text-align:center;cursor:pointer}
</style>
</head>

<body>

<div id="login-page">
 <div class="login-container">
 <h1>LATIHAN SOAL</h1>
 <h1>ÌïúÍµ≠Ïñ¥Ïó∞Ïäµ</h1>
 <p>25 Soal | 50 Menit</p>
 <input id="username" placeholder="Username / Ïù¥Î¶Ñ">
 <input id="password" type="password" placeholder="Password / ÎπÑÎ∞ÄÎ≤àÌò∏">
 <input id="kode" placeholder="Kode Soal / ÏãúÌóòÏΩîÎìú">
 <button id="btnLogin">LOGIN / Î°úÍ∑∏Ïù∏</button>
 </div>
</div>

<div id="quiz-page">
 <div class="header-fixed">
 <div class="submit-top" id="submitTop">SUBMIT</div>
 <div class="timer" id="timer">50:00</div>
 </div>
 <div class="container"><form id="quiz-form"></form></div>
 <div class="nav-bottom">
 <button id="prev">PREV</button>
 <button id="next">NEXT</button>
 </div>
</div>

<div id="result-page">
 <div class="result-box" id="resultBox"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const validCredentials={
 "uus":"123","user01":"12345","hanarizka":"Nungkihana24!","user3":"12345",
 "siswa01":"12345","windi":"Windi2000","rismaya97":"bahasakorea",
 "admin":"admin123"
};

const kodeMapping={
 "B12345":"soal1.json",
 "A09008":"soal2.json",
 "SAREWAE":"test.json",
 "W11765":"soal3.json"
};

const BASE="https://raw.githubusercontent.com/airnetcso/latbakor/main/soal/";

let questions=[],answers=[],current=0,time=3000,interval;
let currentUser="",currentKode="";

btnLogin.onclick=()=>{
 const u=username.value.trim();
 const p=password.value.trim();
 const k=kode.value.trim().toUpperCase();

 if(validCredentials[u]===p && kodeMapping[k]){
  currentUser=u;
  currentKode=k;
  loginPage.style.display="none";
  quizPage.style.display="block";
  loadSoal(kodeMapping[k]);
  startTimer();
 }else alert("Username / Password / Kode salah");
};

async function loadSoal(file){
 questions=await (await fetch(BASE+file)).json();
 answers=Array(questions.length).fill(null);
 quizForm.innerHTML="";
 questions.forEach((q,i)=>{
  quizForm.innerHTML+=`
   <div class="question-wrapper">
    <div class="box-passage">
     ${q.audio?`<audio controls src="${q.audio}"></audio>`:""}
     ${q.image?`<img src="${q.image}">`:""}
    </div>
    <div class="box-question">
     <p><b>${i+1}.</b> ${q.question}</p>
     ${Object.entries(q.options).map(([k,v],idx)=>`
      <label class="option-item">
       <input type="radio" name="q${i}" value="${k}">
       <span class="option-circle">${idx+1}</span>${v}
      </label>`).join("")}
    </div>
   </div>`;
 });
 document.querySelectorAll("input[type=radio]").forEach(r=>{
  r.onchange=()=>answers[+r.name.slice(1)]=r.value;
 });
 show(0);
}

function show(n){
 document.querySelectorAll("audio").forEach(a=>{a.pause();a.currentTime=0});
 document.querySelectorAll(".question-wrapper").forEach((q,i)=>q.classList.toggle("active",i===n));
 current=n;
}

prev.onclick=()=>current>0&&show(current-1);
next.onclick=()=>current<questions.length-1&&show(current+1);

submitTop.onclick=()=>{
 if(answers.includes(null)){alert("Masih ada soal kosong");return;}
 clearInterval(interval);
 quizPage.style.display="none";
 resultPage.style.display="block";

 let score=0,html="";
 questions.forEach((q,i)=>{
  if(answers[i]===q.answer) score+=4;
  else html+=`<div class="wrong-item">
   <b>Soal ${i+1} salah</b><br>
   Jawaban benar: <span class="correct">${q.answer}</span>
  </div>`;
 });

 /* === ADMIN PUSAT (FINAL) === */
 const resultData={
  username: currentUser,
  kode: currentKode,
  nilai: score,
  tanggal: new Date().toLocaleString("id-ID"),
  app: "latbakor"
 };

 let all=JSON.parse(localStorage.getItem("quizResults")||"[]");
 if(!all.some(r=>r.username===resultData.username && r.kode===resultData.kode && r.app==="latbakor")){
  all.push(resultData);
  localStorage.setItem("quizResults",JSON.stringify(all));
 }

 resultBox.innerHTML=`
  <h2>Nilai: ${score}</h2>
  ${html||"<p class='correct'>Semua jawaban benar üéâ</p>"}
  <div class="back-btn" onclick="location.reload()">KEMBALI</div>`;
};

function startTimer(){
 interval=setInterval(()=>{
  timer.textContent=String(Math.floor(time/60)).padStart(2,"0")+":"+String(time%60).padStart(2,"0");
  if(--time<0) submitTop.onclick();
 },1000);
}

});
</script>
</body>
</html>
