<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Latihan Reading Korea</title>
<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f5f5f5}
#login-page{min-height:100vh;display:flex;justify-content:center;align-items:center;
background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') center/cover no-repeat}
.login-container{width:90%;max-width:380px;background:#fff;padding:35px;text-align:center}
input{width:100%;padding:14px;margin:8px 0}
button{width:100%;padding:16px;background:#3f51b5;color:#fff;border:none;font-weight:bold}

#quiz-page{display:none;padding-top:70px;padding-bottom:70px}
.header-fixed{position:fixed;top:0;left:0;width:100%;display:flex;background:#fff;z-index:1000}
.submit-top,.timer{flex:1;padding:12px;text-align:center;font-weight:bold;color:#fff}
.submit-top{background:#f44336}
.timer{background:#4caf50}

.container{max-width:540px;margin:auto;padding:10px;height:calc(100vh - 140px);overflow:auto}
.question-wrapper{display:none}
.question-wrapper.active{display:block}
.box-passage{background:#e3f2fd;padding:15px;margin-bottom:10px}
.box-question{background:#fff3e0;padding:15px}

.option-item{display:flex;margin:8px 0}
.option-circle{width:24px;height:24px;border:2px solid #999;border-radius:50%;
text-align:center;line-height:22px;margin-right:8px}
.option-item input{display:none}
.option-item input:checked + .option-circle{background:#bbdefb;border-color:#2196f3}

.nav-bottom{position:fixed;bottom:0;left:0;width:100%;display:flex}
.nav-bottom button{flex:1;padding:12px;border:none;color:#fff;font-weight:bold}
#prev{background:#2196f3}
#next{background:#ff9800}
</style>
</head>
<body>

<div id="login-page">
  <div class="login-container">
    <h2>Latihan Reading Korea</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <input id="kode" placeholder="Kode Soal">
    <button id="btnLogin">MULAI</button>
  </div>
</div>

<div id="quiz-page">
  <div class="header-fixed">
    <div class="submit-top" id="submitTop">SUBMIT</div>
    <div class="timer" id="timer">50:00</div>
  </div>

  <div class="container">
    <form id="quiz-form"></form>
  </div>

  <div class="nav-bottom">
    <button id="prev">PREV</button>
    <button id="next">NEXT</button>
  </div>
</div>

<script>
const loginPage = document.getElementById("login-page");
const quizPage  = document.getElementById("quiz-page");
const btnLogin  = document.getElementById("btnLogin");
const submitTop= document.getElementById("submitTop");
const quizForm = document.getElementById("quiz-form");
const prevBtn  = document.getElementById("prev");
const nextBtn  = document.getElementById("next");
const timerEl  = document.getElementById("timer");

const validCredentials={
  "uus":"123",
  "kimjong2":"kimju456",
  "siswa01":"tryout26",
  "koreafan":"hanguk789",
  "topik2026":"seoul2026"
};
const kodeMapping={
  "B12345":"soal1.json",
  "A09008":"soal2.json",
  "W11765":"soal3.json",
  "H66633":"soal4.json"
};
const BASE="https://raw.githubusercontent.com/airnetcso/latbakor/main/soal/";

let currentUser="",currentKode="";
let questions=[],answers=[],current=0;
let timeLeft=50*60,timerInterval,submitted=false;

btnLogin.onclick=()=>{
  const u=username.value.trim();
  const p=password.value.trim();
  const k=kode.value.trim().toUpperCase();
  if(validCredentials[u]!==p||!kodeMapping[k]){
    alert("Username, Password, atau Kode Soal salah!");
    return;
  }
  currentUser=u; currentKode=k;
  loginPage.style.display="none";
  quizPage.style.display="block";
  startTimer();
  loadSoal(kodeMapping[k]);
};

async function loadSoal(file){
  const r=await fetch(BASE+file+"?t="+Date.now());
  questions=(await r.json()).slice(0,25);
  answers=Array(questions.length).fill(null);
  render(); show(0);
}

function render(){
  quizForm.innerHTML="";
  questions.forEach((q,i)=>{
    const d=document.createElement("div");
    d.className="question-wrapper";
    d.innerHTML=`
      <div class="box-passage">
        ${q.audio?`<audio controls src="${q.audio}"></audio>`:""}
        ${q.image?`<img src="${q.image}" width="100%">`:""}
      </div>
      <div class="box-question">
        <b>${i+1}.</b> ${q.question}
        ${Object.entries(q.options).map(([k,v],n)=>`
          <label class="option-item">
            <input type="radio" name="q${i}" value="${k}">
            <span class="option-circle">${n+1}</span>${v}
          </label>`).join("")}
      </div>`;
    d.querySelectorAll("input").forEach(r=>r.onchange=()=>answers[i]=r.value);
    quizForm.appendChild(d);
  });
}

function show(n){
  document.querySelectorAll(".question-wrapper")
    .forEach((q,i)=>q.classList.toggle("active",i===n));
  current=n;
}

prevBtn.onclick=()=>current>0&&show(current-1);
nextBtn.onclick=()=>current<questions.length-1&&show(current+1);
submitTop.onclick=()=>submitQuiz();

function submitQuiz(){
  if(submitted) return;
  submitted=true;
  clearInterval(timerInterval);
  let benar=0;
  questions.forEach((q,i)=>answers[i]===q.correct&&benar++);
  alert(`Selesai! Nilai: ${benar*4}`);
}

function startTimer(){
  timerInterval=setInterval(()=>{
    const m=String(Math.floor(timeLeft/60)).padStart(2,"0");
    const s=String(timeLeft%60).padStart(2,"0");
    timerEl.textContent=`${m}:${s}`;
    timeLeft--;
    if(timeLeft<0) submitQuiz();
  },1000);
}
</script>
</body>
</html>
