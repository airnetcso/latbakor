<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Latihan Reading Korea</title>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5}
#login-page,#quiz-page,#result-page{display:none}

/* LOGIN */
#login-page{
  display:flex;min-height:100vh;
  justify-content:center;align-items:center;
  background:#263238
}
.login-box{
  background:#fff;padding:30px;
  width:90%;max-width:380px;text-align:center
}
input,button{width:100%;padding:14px;margin:8px 0}
button{background:#3f51b5;color:#fff;border:none;font-weight:bold}

/* QUIZ */
#quiz-page{padding-top:60px;padding-bottom:60px}
.header{position:fixed;top:0;left:0;width:100%;display:flex}
.submit-btn,.timer{flex:1;padding:12px;color:#fff;font-weight:bold;text-align:center}
.submit-btn{background:#e53935}
.timer{background:#43a047}

.container{
  max-width:540px;margin:auto;
  padding:10px;height:calc(100vh - 120px);
  overflow:auto
}
.qbox{display:none}
.qbox.active{display:block}

.option{display:flex;margin:6px 0}
.option input{display:none}
.circle{
  width:24px;height:24px;border:2px solid #888;
  border-radius:50%;text-align:center;
  line-height:22px;margin-right:8px
}
.option input:checked + .circle{
  background:#bbdefb;border-color:#2196f3
}

.nav{position:fixed;bottom:0;left:0;width:100%;display:flex}
.nav button{flex:1;padding:12px;border:none;color:#fff;font-weight:bold}
#prev{background:#1e88e5}
#next{background:#fb8c00}

/* RESULT */
#result-page{padding:20px}
.wrong{background:#ffebee;padding:10px;margin:8px 0}
</style>
</head>

<body>

<div id="login-page">
  <div class="login-box">
    <h2>Latihan Reading Korea</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <input id="kode" placeholder="Kode Soal">
    <button id="btnLogin">MULAI</button>
  </div>
</div>

<div id="quiz-page">
  <div class="header">
    <div class="submit-btn" id="submitBtn">SUBMIT</div>
    <div class="timer" id="timer">50:00</div>
  </div>

  <div class="container" id="quizForm"></div>

  <div class="nav">
    <button id="prev">PREV</button>
    <button id="next">NEXT</button>
  </div>
</div>

<div id="result-page">
  <h2>Hasil</h2>
  <div id="score"></div>
  <div id="review"></div>
  <button onclick="location.reload()">KEMBALI</button>
</div>

<script>
/* === ELEMENT === */
const loginPage=document.getElementById("login-page");
const quizPage=document.getElementById("quiz-page");
const resultPage=document.getElementById("result-page");
const quizForm=document.getElementById("quizForm");

/* === LOGIN DATA === */
const validCredentials={
  "uus":"123",
  "kimjong2":"kimju456",
  "siswa01":"tryout26",
  "koreafan":"hanguk789",
  "topik2026":"seoul2026"
};
const kodeMapping={
  "B12345":"soal1.json",
  "A09008":"soal2.json",
  "W11765":"soal3.json",
  "H66633":"soal4.json"
};
const BASE="https://raw.githubusercontent.com/airnetcso/latbakor/main/soal/";

/* === STATE === */
let questions=[],answers=[],current=0;
let timeLeft=50*60,timerInt,submitted=false;

/* === LOGIN === */
btnLogin.onclick=async()=>{
  const u=username.value.trim();
  const p=password.value.trim();
  const k=kode.value.trim().toUpperCase();

  if(validCredentials[u]!==p||!kodeMapping[k]){
    alert("Login salah");
    return;
  }

  loginPage.style.display="none";
  quizPage.style.display="block";

  startTimer();
  loadSoal(kodeMapping[k]);
};

/* === LOAD === */
async function loadSoal(file){
  const r=await fetch(BASE+file+"?t="+Date.now());
  questions=(await r.json()).slice(0,25);
  answers=Array(questions.length).fill(null);
  render(); show(0);
}

/* === RENDER === */
function render(){
  quizForm.innerHTML="";
  questions.forEach((q,i)=>{
    const d=document.createElement("div");
    d.className="qbox";
    d.innerHTML=`
      ${q.audio?`<audio controls src="${q.audio}"></audio>`:""}
      ${q.image?`<img src="${q.image}" width="100%">`:""}
      <p><b>${i+1}.</b> ${q.question}</p>
      ${Object.entries(q.options).map(([k,v],n)=>`
        <label class="option">
          <input type="radio" name="q${i}" value="${k}">
          <span class="circle">${n+1}</span>${v}
        </label>`).join("")}
    `;
    d.querySelectorAll("input").forEach(r=>{
      r.onchange=()=>answers[i]=r.value;
    });
    quizForm.appendChild(d);
  });
}

/* === NAV === */
function show(n){
  document.querySelectorAll(".qbox")
    .forEach((q,i)=>q.classList.toggle("active",i===n));
  current=n;
}
prev.onclick=()=>current>0&&show(current-1);
next.onclick=()=>current<questions.length-1&&show(current+1);

/* === SUBMIT === */
submitBtn.onclick=()=>submitQuiz(false);

function submitQuiz(auto){
  if(submitted) return;
  if(!auto){
    const idx=answers.findIndex(a=>a===null);
    if(idx!==-1){alert("Soal "+(idx+1)+" belum dijawab");show(idx);return;}
  }
  submitted=true;
  clearInterval(timerInt);

  quizPage.style.display="none";
  resultPage.style.display="block";

  let benar=0;
  review.innerHTML="";
  questions.forEach((q,i)=>{
    if(answers[i]===q.correct) benar++;
    else review.innerHTML+=`
      <div class="wrong">
        Soal ${i+1}<br>
        Jawaban benar: ${q.correct}<br>
        ${q.explanation||""}
      </div>`;
  });
  score.innerHTML="<h3>Nilai: "+(benar*4)+"</h3>";
}

/* === TIMER === */
function startTimer(){
  timerInt=setInterval(()=>{
    const m=String(Math.floor(timeLeft/60)).padStart(2,"0");
    const s=String(timeLeft%60).padStart(2,"0");
    timer.textContent=m+":"+s;
    timeLeft--;
    if(timeLeft<0) submitQuiz(true);
  },1000);
}

/* INIT */
loginPage.style.display="flex";
</script>

</body>
</html>
